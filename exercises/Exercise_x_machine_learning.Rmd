---
title: "Basic machine learning"
output: html_notebook
---

## Packages and commands

Load up the packages
* tidyverse
* caret

```{r packages}
library(tidyverse)
library(caret)
```

Let's load up example data - load "mne_data.csv".

Use gather() and separate() 

```{r load_data} 
mne_data <- read_csv('../data/mne_data.csv', progress = FALSE) %>%
  gather(electrode,amplitude, -condition, -epoch, -time) %>%
  spread(electrode,amplitude) %>%
  separate(condition, c("light","touch","report"), sep = "/")
```

The aim of this exercise is to use a machine learning method to produce a linear classifier that that can classify trials 


*caret* is the main pac

To do machine learning, we need to split our data into training and test sets. The algorithm will build a classifer using the training data, and its performance will be judged by its ability to classify trials from the test set correctly. 


```{r}
fitControl <- trainControl(method = "cv",
                           number = 5
                           )
```

Use *nest()* 

```{r}
classify_data <- mne_data %>%
  select(-touch,-report,-epoch) %>%
  nest(-time) %>%
  mutate(fit = map(data, ~train(light ~ ., data = .x, preProcess = "scale",
                                method = "glmnet", family = "binomial", trControl = fitControl)))

ZZ <- data.frame(Accuracy = map(z$fit,"resample") %>%
                   map("Accuracy") %>%
                   map_dbl(~mean(.x)), time = z$time)
ZZ$time <- z$time

ggplot(ZZ, aes(time, Accuracy))+geom_line()
```